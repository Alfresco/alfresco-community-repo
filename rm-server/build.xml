<?xml version="1.0"?>
<project name="rm-server" basedir=".">
   <property name="groupId" value="org.alfresco"/>
   <property name="artifactId" value="alfresco"/>
   <property name="version" value="4.2.0"/>
   <property name="packaging" value="war"/>
   <property environment="env" />
   <property name="mvn" value="${env.MAVEN_HOME}/bin/mvn.bat" />
   <property name="target" location="target" />
   <property name="tomcat" location="${target}/../../../software/tomcat" />
   <property name="webapps" value="${tomcat}/webapps" />
   <property name="app.name" value="alfresco" />
   <property name="app.folder" location="${webapps}/${app.name}" />
   <property name="app.package" value="${app.name}.${packaging}" />
   <property name="app.package.path" location="${webapps}/${app.package}" />

   <target name="clean">
      <delete dir="${target}" />
   </target>

   <target name="install" depends="clean">
      <exec executable="${mvn}">
         <arg value="install" />
         <arg value="-DskipTests" />
      </exec>
   </target>

   <target name="fetchWarFile">
      <exec executable="${mvn}">
         <arg value="dependency:get" />
         <arg value="-DgroupId=${groupId}" />
         <arg value="-DartifactId=${artifactId}" />
         <arg value="-Dversion=${version}" />
         <arg value="-Dpackaging=${packaging}" />
         <arg value="-Ddest=${app.package}" />
      </exec>
   </target>

   <target name="copyWarFileToTarget">
      <copy file="${app.package}" todir="${target}"/>
   </target>

   <target name="deleteWarFile">
      <delete file="${app.package.path}" />
   </target>

   <target name="deleteExplodedWar">
      <delete dir="${app.folder}"/>
   </target>

   <target name="alfresco:amp" depends="install">
      <exec executable="${mvn}">
         <arg value="alfresco:amp" />
      </exec>
   </target>

   <target name="alfresco:install" depends="deleteWarFile, deleteExplodedWar, alfresco:amp, copyWarFileToTarget">
      <exec executable="${mvn}">
         <arg value="alfresco:install" />
      </exec>
   </target>

   <target name="build" depends="alfresco:install" description="">
      <copy file="${target}/${app.package}" todir="${webapps}"/>
   </target>
</project>